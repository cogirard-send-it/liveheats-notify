<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LiveHeats Notifier</title>

  <!-- Link the manifest at the correct subpath on GitHub Pages -->
  <link rel="manifest" href="/liveheats-notify/manifest.json?v=2">

  <!-- PWA / iOS meta -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="LiveHeats">
  <meta name="theme-color" content="#ffffff">

  <style>
    body { font-family: -apple-system, system-ui, Arial, sans-serif; padding: 24px; }
    button { padding: 10px 16px; font-size: 16px; }
    #status { margin-top: 16px; font-weight: 600; }
  </style>
</head>

<body>
  <h2>LiveHeats iPhone Notifier</h2>
  <p>Open this app from your Home Screen and tap the button to enable notifications.</p>

  <button id="btn-sub">Enable Notifications</button>
  <div id="status"></div>

  <script>
    // Always register the SW with the correct scope for GitHub Pages subfolder
    async function ensureServiceWorker() {
      if (!('serviceWorker' in navigator)) {
        document.getElementById('status').innerText = 'Service Worker not supported';
        return null;
      }
      try {
        const reg = await navigator.serviceWorker.register('/liveheats-notify/service-worker.js', { scope: '/liveheats-notify/' });
        return reg;
      } catch (e) {
        console.error('SW register failed', e);
        document.getElementById('status').innerText = 'SW registration failed';
        return null;
      }
    }

    async function subscribe() {
      try {
        const reg = await ensureServiceWorker();
        if (!reg) return;

        // iOS requires a user gesture before showing the permission prompt
        const permission = await Notification.requestPermission();
        if (permission !== 'granted') {
          document.getElementById('status').innerText = 'Notifications not granted';
          return;
        }

        // TODO: replace with your real VAPID key after Step 9
        const applicationServerKey = 'YOUR_PUBLIC_VAPID_KEY';
        const sub = await reg.pushManager.subscribe({
          userVisibleOnly: true,
          applicationServerKey
        });

        // TODO: send `sub` to your backend (weâ€™ll do this after Step 9)
        console.log('Push subscription:', JSON.stringify(sub));
        document.getElementById('status').innerText = 'Subscribed! (check console for details)';
      } catch (err) {
        console.error(err);
        document.getElementById('status').innerText = 'Subscription failed (see console)';
      }
    }

    document.getElementById('btn-sub').addEventListener('click', subscribe);
  </script>
</body>
</html>
``
